<mxfile host="drawio-plugin" modified="2024-11-07T01:38:41.225Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36" etag="uXGWPl96EWpNiP8wc2an" version="20.5.3" type="embed"><diagram id="9U9vTj_1QLf3KQhBxJZr" name="Page-1"><mxGraphModel dx="1146" dy="693" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0"><root><mxCell id="0"/><mxCell id="1" parent="0"/><mxCell id="5" value="User" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="50" y="210" width="140" height="90" as="geometry"/></mxCell><mxCell id="6" value="string name" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="5" vertex="1"><mxGeometry y="30" width="140" height="30" as="geometry"/></mxCell><mxCell id="8" value="repeated int role_id" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="5" vertex="1"><mxGeometry y="60" width="140" height="30" as="geometry"/></mxCell><mxCell id="10" value="Role" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="280" y="140" width="160" height="210" as="geometry"/></mxCell><mxCell id="14" value="int64 id" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="10" vertex="1"><mxGeometry y="30" width="160" height="30" as="geometry"/></mxCell><mxCell id="11" value="string name" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="10" vertex="1"><mxGeometry y="60" width="160" height="30" as="geometry"/></mxCell><mxCell id="108" value="string namespace" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="10" vertex="1"><mxGeometry y="90" width="160" height="30" as="geometry"/></mxCell><mxCell id="105" value="repeated string service" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="10" vertex="1"><mxGeometry y="120" width="160" height="30" as="geometry"/></mxCell><mxCell id="106" value="repeated string resource" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="10" vertex="1"><mxGeometry y="150" width="160" height="30" as="geometry"/></mxCell><mxCell id="107" value="repeated string verbs" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="10" vertex="1"><mxGeometry y="180" width="160" height="30" as="geometry"/></mxCell><mxCell id="15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="8" target="14" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="67" value="一个用户可以赋予多种角色" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1"><mxGeometry x="45" y="640" width="150" height="30" as="geometry"/></mxCell><mxCell id="77" value="Endpoint" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="590" y="160" width="140" height="180" as="geometry"><mxRectangle x="760" y="460" width="90" height="30" as="alternateBounds"/></mxGeometry></mxCell><mxCell id="78" value="string service" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="77" vertex="1"><mxGeometry y="30" width="140" height="30" as="geometry"/></mxCell><mxCell id="79" value="string resource" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="77" vertex="1"><mxGeometry y="60" width="140" height="30" as="geometry"/></mxCell><mxCell id="80" value="string verb" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="77" vertex="1"><mxGeometry y="90" width="140" height="30" as="geometry"/></mxCell><mxCell id="81" value="string identity" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="77" vertex="1"><mxGeometry y="120" width="140" height="30" as="geometry"/></mxCell><mxCell id="130" value="string doc" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="77" vertex="1"><mxGeometry y="150" width="140" height="30" as="geometry"/></mxCell><mxCell id="104" value="&lt;h1&gt;路由端点&lt;/h1&gt;&lt;p&gt;1. 唯一标识：&lt;/p&gt;&lt;p&gt;- Identity 用来唯一标识一条路由&lt;/p&gt;&lt;p&gt;- 格式为 service.resource.method.uri&lt;/p&gt;&lt;p&gt;2. 授权标签：&lt;/p&gt;&lt;p&gt;-&amp;nbsp; service、resource、verb 是路由元数据&lt;/p&gt;&lt;p&gt;- 将这三个元数据作为标签应用给路由&lt;/p&gt;&lt;p&gt;- 权限匹配机制会根据标签进行&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1"><mxGeometry x="770" y="160" width="410" height="240" as="geometry"/></mxCell><mxCell id="109" value="Role" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="280" y="380" width="160" height="210" as="geometry"/></mxCell><mxCell id="110" value="int64 id" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="109" vertex="1"><mxGeometry y="30" width="160" height="30" as="geometry"/></mxCell><mxCell id="111" value="string name" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="109" vertex="1"><mxGeometry y="60" width="160" height="30" as="geometry"/></mxCell><mxCell id="112" value="string namespace" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="109" vertex="1"><mxGeometry y="90" width="160" height="30" as="geometry"/></mxCell><mxCell id="113" value="repeated string service" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="109" vertex="1"><mxGeometry y="120" width="160" height="30" as="geometry"/></mxCell><mxCell id="114" value="repeated string resource" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="109" vertex="1"><mxGeometry y="150" width="160" height="30" as="geometry"/></mxCell><mxCell id="115" value="repeated string verbs" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="109" vertex="1"><mxGeometry y="180" width="160" height="30" as="geometry"/></mxCell><mxCell id="116" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="8" target="110" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="117" value="Endpoint" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;" parent="1" vertex="1"><mxGeometry x="590" y="410" width="140" height="180" as="geometry"><mxRectangle x="760" y="460" width="90" height="30" as="alternateBounds"/></mxGeometry></mxCell><mxCell id="118" value="string service" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="117" vertex="1"><mxGeometry y="30" width="140" height="30" as="geometry"/></mxCell><mxCell id="119" value="string resource" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="117" vertex="1"><mxGeometry y="60" width="140" height="30" as="geometry"/></mxCell><mxCell id="120" value="string verb" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="117" vertex="1"><mxGeometry y="90" width="140" height="30" as="geometry"/></mxCell><mxCell id="121" value="string identity" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="117" vertex="1"><mxGeometry y="120" width="140" height="30" as="geometry"/></mxCell><mxCell id="131" value="string doc" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="117" vertex="1"><mxGeometry y="150" width="140" height="30" as="geometry"/></mxCell><mxCell id="122" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="105" target="78" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="440" y="280" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="123" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="106" target="79" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="440" y="310" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="124" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="107" target="80" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="125" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="118" edge="1"><mxGeometry relative="1" as="geometry"><mxPoint x="440" y="275" as="sourcePoint"/></mxGeometry></mxCell><mxCell id="126" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="106" target="119" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="127" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="107" target="120" edge="1"><mxGeometry relative="1" as="geometry"/></mxCell><mxCell id="129" value="&lt;h1&gt;权限匹配&lt;/h1&gt;&lt;p&gt;Role 角色不能去关联 Endpoint 端点的ID&lt;/p&gt;&lt;p&gt;因为服务重启后，会删除掉旧端点、并重新注册新端点；此时Role 关联的ID 会丢失&lt;/p&gt;&lt;p&gt;应该使用权限匹配机制，不论服务的端点删除、创建多少次，只要Lable 不变，权限就不变&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1"><mxGeometry x="280" y="610" width="620" height="120" as="geometry"/></mxCell></root></mxGraphModel></diagram></mxfile>